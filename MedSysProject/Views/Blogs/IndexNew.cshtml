@{
    ViewData["Title"] = "IndexOld";
    Layout = "~/Views/Shared/_Layout_Blogs.cshtml";
}
<main id="main">

</main>



@section Scripts{
    <script>
        const main = document.querySelector('#main');
        document.addEventListener('DOMContentLoaded', async() => {
            await loadRecentPost();
            await loadNewActivity();
            await loadMedicalNews();
            await loadCelebritySharing();
        })

        //
        async function loadSlider() 
        { //call Api
            
        }

        //
        async function loadRecentPost() 
        { 
            const response = await fetch(`@Url.Content("~/Blogs/LoadRecentPost")`);
            const data = await response.text();
            main.innerHTML += data;
            loadSidePopular();
        }
        async function loadSidePopular() 
        {
            const response = await fetch(`https://localhost:7078/api/Blogs/popular6`);
            const data = await response.json();
            const take5 = data.$values.slice(0, 5);
            const popularContainer = document.querySelector('.trending-post');
            const popular5 = take5.map((blog, index) => {
                const { blogId, title, author, articleClass, createdAt, views } = blog;
                const date = new Date(createdAt);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
                return `
                                    <li>
                                         <a href="@Url.Content("~/Blogs/SinglePost")?SingleBlogId=${blogId}">
                                             <span class="number">${index + 1}</span>
                                                      <h3>
                                                      ${title}
                                                      </h3>
                                                      <h6>瀏覽人次:${views}</h6>
                                                      <span class="author">${author}</span>
                                         </a>
                                    </li>
                                `
            })
            popularContainer.innerHTML = popular5.join('');

        }
        //
        async function loadNewActivity() {
            const response = await fetch(`@Url.Content("~/Blogs/LoadNewActivity")`);
            const data = await response.text();
            main.innerHTML += data;
            loadSideActivity6();
        }
        async function loadSideActivity6()  
        {
            const response = await fetch(`https://localhost:7078/api/Blogs/activity6`);
            const data = await response.json();
            const activityContainer = document.querySelector('.sideActivity');
            const activity6 = data.$values.map(blog => {
                const { blogId, title, author, articleClass, createdAt, views } = blog;
                const date = new Date(createdAt);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
                return`
                                <div class="post-entry-1 border-bottom">
                            <div class="post-meta">
                                <span class="date">${articleClass}</span>
                                <span class="mx-1">&bullet;</span> <span>${formattedDate}</span>
                            </div>
                            <h2 class="mb-2">
                                        <a href=""@Url.Content("~/Blogs/SinglePost")?SingleBlogID=${blogId}">
                                    ${title}
                                    
                                </a>
                            </h2>
                                    <span class="author mb-3 d-block">${author}&nbsp;&nbsp;瀏覽人次:${views}</span>
                        </div>
                `
            });
            activityContainer.innerHTML = activity6.join('');
        }

        async function loadMedicalNews() 
        { 
            const response = await fetch(`@Url.Content("~/Blogs/LoadMedicalNews")`);
            const data = await response.text();
            main.innerHTML += data;
            loadSideMedical6();
        }

        async function loadSideMedical6()
        {
            const response = await fetch(`https://localhost:7078/api/Blogs/medical6`);
            const data = await response.json();
            const medicalContainer = document.querySelector('.sideMedical');
            const medical6 = data.$values.map(blog => { 
                const { blogId, title, author, articleClass, createdAt, views } = blog;
                const date = new Date(createdAt);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`;
                return `
                                        <div class="post-entry-1 border-bottom">
                                    <div class="post-meta">
                                        <span class="date">${articleClass}</span>
                                        <span class="mx-1">&bullet;</span> <span>${formattedDate}</span>
                                    </div>
                                    <h2 class="mb-2">
                                                <a href=""@Url.Content("~/Blogs/SinglePost")?SingleBlogID=${blogId}">
                                            ${title}

                                        </a>
                                    </h2>
                                            <span class="author mb-3 d-block">${author}&nbsp;&nbsp;瀏覽人次:${views}</span>
                                </div>
                        `
            });
            medicalContainer.innerHTML = medical6.join('');
        }
       
        async function loadCelebritySharing() 
        { 
            const response = await fetch(`@Url.Content("~/Blogs/LoadCelebritySharing")`)
            const data = await response.text();
            main.innerHTML += data;
            //loadSideCelebrity6();
        }
        async function loadSideCelebrity() 
        { 
            
        }

    </script>
}