@{
    ViewData["Title"] = "testplan";
    Layout = "~/Views/Shared/_Layout_Fore.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style>
        h5 {
            font-size: 32px;
            font-weight: bold;
        }

        .bg {
            background-image: url('/img/personalplan/tree.jpg');
            background-size: cover;
            background-position: top center;
        }


        #plansSection {
            display: flex;
            flex-wrap: nowrap; 
            overflow-x: hidden; 
            justify-content: center; 
        }

        .card {
            background-position: center;
            background-size: contain;
            flex: 0 0 auto;
            margin: 0; /* 移除外邊距，使每個卡片之間沒有留白 */
            padding: 0; /* 移除內邊距，確保內容填滿整個卡片 */
            min-width: 0;
            width: 60%;
            box-sizing: border-box;
        }
    </style>
  
    </head>
    <body>
    <h4 class="bg-green" style="background-color: aliceblue"><strong class="text-dark">企業方案個人健檢項目比較</strong></h4>
    <section class="text-center">
        <button id="addPlanButton" class="btn btn-primary">增加比較方案</button>
    </section>

    <!-- 新增的容器來包裹兩個區塊 -->
    <div class="container-fluid">
        <div class="row">
            <!-- 所有項目的列表 -->
            <div class="col-lg-3">
                <div class="card">
                    <div class="card-header bg-white py-3">
                        所有項目
                    </div>
                    <ul class="list-group list-group-flush" id="allProjectsList"></ul>
                </div>
            </div>

            <!-- 方案比較區 -->
            <div class="col-lg-9" id="plansSection"></div>
        </div>
    </div>



    <script>
        var globalPlans; // 全局變數儲存所有方案
        var globalProjects; // 全局變數儲存所有項目

        $(document).ready(function () {
            loadData();
        });

            // 綁定按鈕點擊事件
            $('#addPlanButton').click(addNewPlanComparison);
        

        function addNewPlanComparison() {
            var planCount = $('#plansSection').children().length;
            if (planCount < globalPlans.length) {
                var newPlanDiv = $('<div/>', { class: 'col-lg-3' }).appendTo('#plansSection');
                var newCard = $('<div/>', { class: 'card' }).appendTo(newPlanDiv);
                var newCardHeader = $('<div/>', { class: 'card-header bg-white py-3' }).appendTo(newCard);
                var newSelect = $('<select/>', { class: 'form-control' }).appendTo(newCardHeader);
                var newCardBody = $('<div/>', { class: 'card-body' }).appendTo(newCard);
                var newProjectsList = $('<ul/>', { class: 'list-group list-group-flush' }).appendTo(newCardBody);

                initPlanSelect(newSelect, newProjectsList);
            } else {
                alert('已達最大方案比較數量');
            }
        }

        // 函數：更新項目列表
        function updateProjectsList(planProjects, projectsList) {
            projectsList.empty();
            globalProjects.forEach(function (project) {
                var includesProject = planProjects.some(p => p.projectId === project.projectId);
                var symbol = includesProject ? 'O' : 'X';
                projectsList.append('<li class="list-group-item">' + symbol + '</li>');
            });
        }

        // 函數：初始化方案選擇下拉列表
        function initPlanSelect(planSelect, projectsList) {
            planSelect.empty(); // 清空現有選項
            planSelect.append(new Option('---請選擇方案---', '', true, true));

            globalPlans.forEach(function (plan) {
                if (plan.planName !== "非套餐方案") {
                    planSelect.append(new Option(plan.planName, plan.planId));
                }
            });

            planSelect.change(function () {
                var selectedPlanId = $(this).val();
                var selectedPlan = globalPlans.find(p => p.planId == selectedPlanId);
                updateProjectsList(selectedPlan ? selectedPlan.projects : [], projectsList);
            });
        }

        // Ajax 請求獲取方案和項目數據
        function loadData() {
            $.ajax({
                url: '@Url.Action("GetPlansAndProjects", "Home")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    globalPlans = data.plans;
                    initPlanSelect($('#planSelect'), $('#projectsList'));
                },
                error: function (error) {
                    console.error("獲取方案時發生錯誤: ", error);
                }
            });

            $.ajax({
                url: '@Url.Action("GetAllProjects", "Home")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    globalProjects = data;
                    updateAllProjectsList(); // 新增函數呼叫
                },
                error: function (error) {
                    console.error("獲取項目時發生錯誤: ", error);
                }
            });
        }
        function updateAllProjectsList() {
            var allProjectsList = $('#allProjectsList');
            allProjectsList.empty();
            globalProjects.forEach(function (project) {
                allProjectsList.append('<li class="list-group-item">' + project.projectName + '</li>');
            });
        };


        $(document).ready(function () {
            loadData();
        });
    </script>


  





</body>

</html>


<!--Grid column-->
@section Scripts{
    <script>

    </script>
   

    }