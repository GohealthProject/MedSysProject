@{
    ViewData["Title"] = "testplan";
    Layout = "~/Views/Shared/_Layout_Fore.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style>
        h5 {
            font-size: 32px;
            font-weight: bold;
        }

        .bg {
            background-image: url('/img/personalplan/tree.jpg');
            background-size: cover;
            background-position: top center;
        }


        #plansSection {
            display: flex;
            flex-wrap: nowrap; 
            overflow-x: hidden; 
            justify-content: center; 
        }

        .card {
            background-position: center;
            background-size: contain;
            flex: 0 0 auto;
            margin: 0; /* 移除外邊距，使每個卡片之間沒有留白 */
            padding: 0; /* 移除內邊距，確保內容填滿整個卡片 */
            min-width: 0;
            width: 60%;
            box-sizing: border-box;
        }

        .table tbody tr {
            height: auto; /* 調整行高 */
        }

        .table tbody tr td {
                vertical-align: middle; /* 垂直居中 */
            }
    </style>
  
    </head>
<body>
    <h4 class="bg-green" style="background-color: aliceblue"><strong class="text-dark">企業方案個人健檢項目比較</strong></h4>
    <section class="text-center">
        <button id="addPlanButton" class="btn btn-primary">增加比較方案</button>
    </section>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>健檢項目</th>
                <th id="plansHeader">
                    <select id="planSelect" class="form-control">
                        <!-- 選項將動態添加 -->
                    </select>
                </th>
            </tr>
        </thead>
        <tbody id="comparisonTableBody">
            <!-- 動態添加項目和方案比較的行 -->
        </tbody>
    </table>


    <script>
        var globalPlans; // 全局變數儲存所有方案
        var globalProjects; // 全局變數儲存所有項目
        var addedPlans = []; // 儲存已添加的方案

        $(document).ready(function () {
            loadData();
            $('#addPlanButton').click(addPlanSelectColumn); // 綁定按鈕點擊事件
        });

        // 初始化下拉選單
        function initPlanSelect(planSelect) {
            planSelect.empty();
            planSelect.append(new Option('---請選擇方案---', '', true, true));

            globalPlans.forEach(function (plan) {
                if (plan.planName !== "非套餐方案" && !addedPlans.includes(plan.planId.toString())) {
                    planSelect.append(new Option(plan.planName, plan.planId));
                }
            });

            planSelect.change(function () {
                var selectedPlanId = $(this).val();
                if (!selectedPlanId) return; // 避免空選項觸發

                var selectedPlan = globalPlans.find(p => p.planId == selectedPlanId);
                addPlanColumn(selectedPlan);
                addedPlans.push(selectedPlanId); // 將選擇的方案ID添加到陣列中
                $(this).prop('disabled', true); // 禁用選擇過的選單
            });
        }

        // 在表頭添加新的下拉選單
        function addPlanSelectColumn() {
            if (addedPlans.length >= globalPlans.length - 1) {
                alert("已達最大方案比較量！");
                return;
            }

            var newSelect = $('<select/>', { class: 'form-control plan-select' });
            initPlanSelect(newSelect);
            var newTh = $('<th></th>').append(newSelect);

            var lastPlanSelectTh = $('th:has(.plan-select)').last();
            if (lastPlanSelectTh.length === 0) {
                // 如果還沒有添加過下拉選單，則將其添加到初始下拉選單之後
                $('#plansHeader').after(newTh);
            } else {
                // 否則添加到最後一個下拉選單之後
                lastPlanSelectTh.after(newTh);
            }
        }

        // 添加方案比較列
        function addPlanColumn(plan) {
            var tableBody = $('#comparisonTableBody');
            tableBody.find('tr').each(function (index, tr) {
                var project = globalProjects[index];
                var includesProject = plan.projects.some(p => p.projectId === project.projectId);
                var symbol = includesProject ? 'O' : 'X';
                var newTd = $('<td></td>').text(symbol);
                $(tr).append(newTd); // 添加新列
            });
        }

        function loadData() {
            $.ajax({
                url: '@Url.Action("GetPlansAndProjects", "Home")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    globalPlans = data.plans;
                    initPlanSelect($('#planSelect'));
                },
                error: function (error) {
                    console.error("獲取方案時發生錯誤: ", error);
                }
            });

            $.ajax({
                url: '@Url.Action("GetAllProjects", "Home")',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    globalProjects = data;
                    createComparisonTableRows(); // 創建項目行
                },
                error: function (error) {
                    console.error("獲取項目時發生錯誤: ", error);
                }
            });
        }

        function createComparisonTableRows() {
            var tableBody = $('#comparisonTableBody');
            tableBody.empty();
            globalProjects.forEach(function (project) {
                var row = $('<tr></tr>');
                row.append('<td>' + project.projectName + '</td>'); // 項目名稱
                tableBody.append(row);
            });
        }
    </script>

    




</body>

</html>


<!--Grid column-->
@section Scripts{
    <script>

    </script>
   

    }