@{
    ViewData["Title"] = "testplan";
    Layout = "~/Views/Shared/_Layout_Fore.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <style>
        h5 {
            font-size: 32px;
            font-weight: bold;
        }

        .bg {
            background-image: url('/img/personalplan/tree.jpg');
            background-size: cover;
            background-position: top center;
        }


        #plansSection {
            display: flex;
            flex-wrap: nowrap; 
            overflow-x: hidden; 
            justify-content: center; 
        }

        .card {
            background-color: #2F8927;
            background-position: center;
            background-size: contain;
            border: solid;
            border-color: #2F8927;
            flex: 0 0 auto;
            margin: 0; /* 移除外邊距，使每個卡片之間沒有留白 */
            padding: 0; /* 移除內邊距，確保內容填滿整個卡片 */
            min-width: 0;
            width: 80%;
            box-sizing: border-box;
        }
    </style>
  
    </head>
    <body>
        <h4 class="bg-green" style="background-color: aliceblue"><strong class="text-dark">企業方案個人健檢項目比較</strong></h4>
            <section class="text-center">
            <button id="addPlanButton" class="btn btn-primary">增加比較方案</button>
            </section>
            <div @* class="row gx-lg-6" *@ id="plansSection">
            </div>
    <script>
        var selectedPlanIds = []; // 儲存已選擇的方案 ID
        var globalPlans; // 全局變數儲存所有方案

        // 函數：更新項目列表
        function updateProjectsList(projects, projectsList) {
            projectsList.empty(); // 清空現有項目
            projects.forEach(function (project) {
                projectsList.append('<li class="list-group-item">' + project.projectName + '</li>');
            });
        }

        // 函數：初始化方案選擇下拉列表和對應的項目列表
        function initPlanSelect(planSelect, projectsList) {
            planSelect.empty(); // 清空現有選項
            planSelect.append(new Option('---請選擇方案---', '', true, true));

            globalPlans.forEach(function (plan) {
                if (plan.planName !== "非套餐方案" && !selectedPlanIds.includes(plan.planId)) {
                    planSelect.append(new Option(plan.planName, plan.planId));
                }
            });

            planSelect.change(function () {
                var selectedPlanId = $(this).val();
                if (!selectedPlanIds.includes(selectedPlanId) && selectedPlanId) {
                    selectedPlanIds.push(selectedPlanId);
                    var selectedPlan = globalPlans.find(p => p.planId == selectedPlanId);
                    updateProjectsList(selectedPlan ? selectedPlan.projects : [], projectsList);
                }
            });
        }

        // 函數：新增方案比較區域
        function addNewPlanComparison() {
            if ($('#plansSection').children().length < globalPlans.length - 1) {
                var newPlanDiv = $('<div/>', { class: 'col-lg-3' }).appendTo('#plansSection');
                var newCard = $('<div/>', { class: 'card' }).appendTo(newPlanDiv);
                var newCardHeader = $('<div/>', { class: 'card-header bg-white py-3' }).appendTo(newCard);
                var newSelect = $('<select/>', { class: 'form-control' }).appendTo(newCardHeader);
                var newCardBody = $('<div/>', { class: 'card-body' }).appendTo(newCard);
                var newProjectsList = $('<ul/>', { class: 'list-group list-group-flush' }).appendTo(newCardBody);

                initPlanSelect(newSelect, newProjectsList);
            } else {
                alert('已達最大方案比較數量');
            }
        }

        // Ajax 請求獲取方案和項目數據
        $.ajax({
            url: '@Url.Action("GetPlansAndProjects", "Home")',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                globalPlans = data.plans;

                // 初始化第一個方案比較區域
                var firstPlanDiv = $('<div/>', { class: 'col-lg-3' }).appendTo('#plansSection');
                var firstCard = $('<div/>', { class: 'card' }).appendTo(firstPlanDiv);
                var firstCardHeader = $('<div/>', { class: 'card-header bg-white py-3' }).appendTo(firstCard);
                var firstPlanSelect = $('<select/>', { class: 'form-control', id: 'planSelect' }).appendTo(firstCardHeader);
                var firstCardBody = $('<div/>', { class: 'card-body' }).appendTo(firstCard);
                var firstProjectsList = $('<ul/>', { class: 'list-group list-group-flush', id: 'projectsList' }).appendTo(firstCardBody);

                initPlanSelect(firstPlanSelect, firstProjectsList);

                $('#addPlanButton').click(addNewPlanComparison);
            },
            error: function (error) {
                console.error("獲取方案和項目時發生錯誤: ", error);
            }
        });
    </script>


  





</body>

</html>


<!--Grid column-->
@section Scripts{
    <script>

    </script>
   

    }