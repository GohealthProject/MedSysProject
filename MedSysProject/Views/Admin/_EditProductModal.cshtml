@model MedSysProject.Models.CProductsWrap

@{
    ViewData["Title"] = "Edit";
}
@if (ViewBag.Categories == null || Model.ProductsCategories == null)
{
    Console.WriteLine("ViewBag.Categories 或 Model.ProductsCategories 為空。");
}


<div class="container mt-5">
    <hr />
    <div class="row">
        <div class="col-3"></div>
        <div class="col-6">
            <h1>修改產品作業partial view</h1>
            <h4>請輸入欲修改的產品資訊</h4>
                <form asp-action="Edit" method="post" enctype="multipart/form-data">
                    <input type="hidden" id="FimagePaths" name="WrappedFimagePaths" asp-for="WrappedFimagePaths" value="@Model.WrappedFimagePaths" />



                <div class="form-group">
                    <label asp-for="WrappedProductName" class="control-label">產品名稱</label>
                    <input asp-for="WrappedProductName" class="form-control" name="WrappedProductName" />
                    <span asp-validation-for="WrappedProductName" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WrappedUnitPrice" class="control-label">單價</label>
                    <input asp-for="WrappedUnitPrice" class="form-control" name="WrappedUnitPrice" />
                    <span asp-validation-for="WrappedUnitPrice" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WrappedLicense" class="control-label">核可證號</label>
                    <input asp-for="WrappedLicense" class="form-control" name="WrappedLicense" />
                    <span asp-validation-for="WrappedLicense" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WrappedIngredient" class="control-label">有效成分</label>
                    <input asp-for="WrappedIngredient" class="form-control" name="WrappedIngredient" />
                    <span asp-validation-for="WrappedIngredient" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label asp-for="WrappedDescription" class="control-label"></label>
                    <textarea asp-for="WrappedDescription" class="form-control" name="WrappedDescription" rows="8"></textarea>
                    <span asp-validation-for="WrappedDescription" class="text-danger"></span>
                </div>







                <div class="form-group">
                    <label asp-for="WrappedUnitsInStock" class="control-label">庫存</label>
                    <input asp-for="WrappedUnitsInStock" class="form-control" name="WrappedUnitsInStock" />
                    <span asp-validation-for="WrappedUnitsInStock" class="text-danger"></span>
                </div>
                <div class="mb-3">
                    <label for="inputDiscontinued" class="form-label">上架狀態</label>
                    <select class="form-control" id="inputDiscontinued" name="WrappedDiscontinued">
                        <option value="true" selected="@(Model?.WrappedDiscontinued == true)">上架中</option>
                        <option value="false" selected="@(Model?.WrappedDiscontinued == false)">已下架</option>
                    </select>
                </div>
                @foreach (var category in ViewBag.Categories ?? Enumerable.Empty<ProductsCategory>())
                {
                    if (Model != null && Model.SelectedCategories != null && category != null && category.CategoriesId != null)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="category@(category.CategoriesId)" name="SelectedCategories" value="@category.CategoriesId" @(Model.SelectedCategories.Contains(category.CategoriesId) ? "checked" : "")>
                            <label class="form-check-label" for="category@(category.CategoriesId)">
                                @category.CategoriesName
                            </label>
                        </div>
                    }
                    else
                    {
                        // 如果有空值，您可以在這裡輸出一條訊息到控制台或採取其他適當的處理方式。
                        Console.WriteLine("檢測到空值");
                    }
                }
                <div class="mb-3">
                    <label for="formFiles" class="form-label">產品圖片上傳</label>
                    <input class="form-control" type="file" id="formFiles" name="FormFiles" multiple>
                </div>

                <div id="imagePreviewContainer" class="mb-3">
                    <label for="inputDescription" class="form-label">圖片預覽</label>
                    <div id="imagePreview" class="d-flex flex-wrap">
                        <!-- 預覽的圖片將在這裡顯示 -->
                    </div>
                </div>
                <div class="form-group">
                    <input type="submit" value="修改並送出" class="btn btn-primary" name="submitBtn" />
                </div>
            </form>
            </div>
            </div>


    <div>
        <a asp-action="Admin" asp-action="product">回到產品管理一覽表</a>
    </div>

    @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var fileInput = document.getElementById('formFiles');
                if (fileInput) {
                    fileInput.addEventListener('change', function (e) {
                        var fileInput = e.target;
                        var files = fileInput.files;

                        var imagePreviewContainer = document.getElementById('imagePreview');
                        imagePreviewContainer.innerHTML = '';

                        for (let i = 0; i < files.length; i++) {
                            var file = files[i];
                            var reader = new FileReader();
                            reader.onload = function (e) {
                                var imgElement = document.createElement('img');
                                imgElement.src = e.target.result;
                                imgElement.style.maxWidth = '100px';
                                imgElement.style.maxHeight = '100px';
                                imagePreviewContainer.appendChild(imgElement);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                } else {
                    console.error('找不到ID為 formFiles 的文件輸入元素。');
                }
            });
        </script>
    }
        @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
</div>